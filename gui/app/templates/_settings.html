<div class="settings-page">
  <div class="settings-category-container">
    <div 
      ng-repeat="category in categories" 
      ng-click="setSelectedCategory(category)" 
      class="settings-category"
      ng-class="{ 'cat-selected': selectedCategory.name === category.name }"
    >
      <div>
        <i class="fal settings-category-icon" ng-class="category.icon"></i>
      </div>
      <div>
        <div style="font-weight: 600;">
          {{category.name}}
        </div>
        <div style="opacity: 0.7;">
          {{category.description}}
        </div>
      </div>
    </div>
  </div>
  <div class="settings-category-content">
    <h1 class="settings-category-title">{{selectedCategory.name}}</h1>
    <div class="settings-category-select">

      <ui-select 
        ng-model="selectedCategory" 
        on-select="setSelectedCategory($item, $model)" 
        theme="bootstrap"
        search-enabled="false"
      >
        <ui-select-match>
          <div>
            {{$select.selected.name}}
          </div>
        </ui-select-match>
        <ui-select-choices repeat="category in categories | filter: { name: $select.search }" style="position:relative;">
          <div 
            class="settings-category"
            style="border-bottom: none;padding: 10px 0;"
          >
            <div>
              <i class="fal settings-category-icon" ng-class="category.icon"></i>
            </div>
            <div>
              <div style="font-weight: 600;">
                {{category.name}}
              </div>
              <div style="opacity: 0.7;">
                {{category.description}}
              </div>
            </div>
          </div>
        </ui-select-choices>
      </ui-select>

    </div>
    <settings-category-content template="selectedCategory.template" />
  </div>
</div>

<!-- Modal For Editing Overlay Port -->
<script type="text/ng-template" id="changePortModal.html">
  <div class="modal-header">
    <button type="button" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></button>
    <h4 class="modal-title">Edit Web Server Port</h4>
  </div>
  <div class="modal-body">
    <div style="display: flex;flex-direction: column;justify-content: center;align-items: center;margin-top: 15px;">
      <div style="width: 55%; position: relative;">
        <div class="form-group" ng-class="{'has-error': newPortError}">
          <label class="control-label" for="newPort">New Port</label>
          <input type="number" class="form-control" id="newPort" ng-model="newPort" aria-describedby="helpBlock">
          <span id="helpBlock" class="help-block" ng-show="newPortError">This is not a valid port number.</span>
        </div>
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-link" ng-click="dismiss()">Cancel</button>
    <button type="button" class="btn btn-primary" ng-click="changePort()">Change Port</button>
  </div>
</script>

<!-- Modal For Editing Overlay Instances -->
<script type="text/ng-template" id="editOverlayInstances.html">
  <div class="modal-header">
    <button type="button" class="close" aria-label="Close" ng-click="dismiss()"><span aria-hidden="true">&times;</span></button>
    <h4 class="modal-title">Edit Overlay Instances</h4>
  </div>
  <div class="modal-body">
    <table class="table table-hover">
        <thead>
          <tr>
            <th>Name</th>
            <th>URL</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Default</td>
            <td><a href ng-click="showViewUrlModal()">View URL</a></td>
            <td></td>
          </tr>
          <tr ng-repeat="instanceName in getOverlayInstances()">
            <td>{{instanceName}}</td>
            <td><a href ng-click="showViewUrlModal(instanceName)">View URL</a></td>
            <td><span class="effect-delete-btn clickable pull-right" ng-click="deleteOverlayInstanceAtIndex($index)"><i class="far fa-trash-alt"></i></span></td>
          </tr>
        </tbody>
      </table>
      <button class="btn btn-default btn-sm" ng-click="showCreateInstanceModal()">+ Create Instance</button>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-primary" ng-click="dismiss()">Done</button>
  </div>
</script>

<!-- Modal For Adding Overlay Instances -->
<script type="text/ng-template" id="createOverlayInstance.html">
  <div class="modal-header">
    <button type="button" class="close" aria-label="Close" ng-click="dismiss()"><span aria-hidden="true">&times;</span></button>
    <h4 class="modal-title">Create Overlay Instance</h4>
  </div>
  <div class="modal-body">
    <div style="display: flex;flex-direction: column;justify-content: center;align-items: center;margin-top: 15px;">
      <div style="width: 75%; position: relative;">
        <div class="form-group" ng-class="{'has-error': createError}">
          <label class="control-label" for="name">Name</label>
          <input type="text" class="form-control" id="name" ng-model="name" aria-describedby="helpBlock">
          <span id="helpBlock" class="help-block" ng-show="createError">This name is invalid or already exists.</span>
        </div>
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-link" ng-click="dismiss()">Cancel</button>
    <button type="button" class="btn btn-primary" ng-click="create()">Create</button>
  </div>
</script>

<!-- View Backups Modal -->
<script type="text/ng-template" id="backupListModal.html">
  <div class="modal-header flex-row-center jspacebetween">
    <h4 class="modal-title" style="display:inline;">Manage Backups</h4>
  </div>
  <div class="modal-body" style="overflow-y: auto;max-height: 300px;padding-bottom:0;">
    <div class="list-group" style="margin-bottom: 0;">
      <div class="list-group-item flex-row-center jspacebetween" ng-repeat="backup in backups track by $index">
        <div>
            <h4 class="list-group-item-heading" tooltip-append-to-body="true" uib-tooltip="{{backup.backupDateFull}}">{{backup.dayDifference < 1 ? backup.fromNowDisplay : backup.backupDateDisplay}}</h4>
            <p class="list-group-item-text muted">{{backup.size + " KB"}} | {{backup.version}} {{backup.isManual ? "| Manual" : ""}}
        </div>
        <div style="font-size:17px">
          <span uib-tooltip="Prevent Auto-Deletion" tooltip-append-to-body="true" style="margin-right:15px; color:#4379f9;" ng-class="{'muted clickable-dark': !backup.neverDelete, 'clickable': backup.neverDelete}" ng-click="togglePreventDeletion(backup)"><i ng-class="{'far fa-unlock': !backup.neverDelete, 'fas fa-lock': backup.neverDelete}"></i></span>
          <span uib-tooltip="Restore to this backup" tooltip-append-to-body="true" style="margin-right:15px;" class="clickable" ng-click="restoreBackup(backup)"><i class="fal fa-undo-alt"></i></span>
          <span uib-tooltip="Delete backup" tooltip-append-to-body="true" class="clickable" style="color:red;" ng-click="deleteBackup($index,backup)"><i class="fal fa-trash-alt"></i></span>
        </div>
      </div>
    </div>
  </div>
  <div class="modal-footer">
      <button class="btn btn-default pull-left" ng-click="openBackupFolder()">Open Backups Folder</button>
      <button class="btn btn-primary" ng-click="dismiss()">Close</button>
  </div>
</script>
